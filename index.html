<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LèSën Slideshow</title>

<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden}
.wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
img{max-width:100vw;max-height:100vh;object-fit:contain;transition:opacity .35s ease}

.overlay{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  background:radial-gradient(circle at 50% 40%,rgba(255,236,200,.22),rgba(10,10,10,.95));
  z-index:9999;cursor:pointer
}
.card{text-align:center;padding:30px 36px;border-radius:18px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(212,175,55,.35)}
.brand{
  font-family:"Playfair Display","Times New Roman",serif;
  font-size:48px;letter-spacing:.16em;margin:0 0 8px;
  background:linear-gradient(135deg,#fff3d6,#d4af37,#f6e6b7);
  -webkit-background-clip:text;color:transparent
}
.date{font-size:16px;letter-spacing:.18em;color:#e8dfc8;margin-bottom:12px}
.hint{font-size:14px;color:#eae6d8;opacity:.85}
</style>
</head>

<body>

<div class="wrap"><img id="img"></div>

<div id="overlay" class="overlay">
  <div class="card">
    <div class="brand" id="coverTitle">LèSën Wedding♥</div>
    <div class="date" id="coverDate">January 10, 2026</div>
    <div class="hint">點一下播放</div>
  </div>
</div>

<audio id="bgm" loop playsinline></audio>

<script>
/* ===== 讀取 set 參數 ===== */
const params = new URLSearchParams(location.search);
const SET = (params.get("set") || "A").toUpperCase();

/* ===== 載入設定 ===== */
async function loadConfig(){
  const res = await fetch(`./config/${SET}.json`,{cache:"no-store"});
  if(!res.ok) throw "Config not found";
  return await res.json();
}

const img = document.getElementById("img");
const overlay = document.getElementById("overlay");
const bgm = document.getElementById("bgm");

let photos=[], i=0, timer=null, speedMs=3000;

function render(){
  img.style.opacity=0;
  setTimeout(()=>{
    img.src = photos[i];
    img.onload=()=>img.style.opacity=1;
  },120);
}

function next(){
  i++;
  if(i>=photos.length){
    stop();
    overlay.style.display="flex";
    i=0;
    render();
    return;
  }
  render();
}

function start(){
  stop();
  timer=setInterval(next,speedMs);
}
function stop(){
  if(timer) clearInterval(timer);
  timer=null;
}

overlay.onclick = async ()=>{
  overlay.style.display="none";
  try{ await bgm.play(); }catch(e){}
  start();
};

(async()=>{
  const cfg = await loadConfig();

  document.getElementById("coverTitle").textContent = cfg.coverTitle;
  document.getElementById("coverDate").textContent  = cfg.coverDate;
  speedMs = cfg.speedSec * 1000;

  bgm.src = cfg.music;

  const plist = await fetch(cfg.photosJson,{cache:"no-store"});
  photos = await plist.json();

  render();
})();
</script>
</body>
</html>
