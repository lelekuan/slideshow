<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LèSën Slideshow</title>

<!-- ===== Google Analytics 4 ===== -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TB8FEJRVXY"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-TB8FEJRVXY');
</script>

<style>
html,body{
  margin:0;height:100%;
  background:#000;overflow:hidden
}
.wrap{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center
}

/* ================= Slides (true cross-fade) ================= */
.slide{
  position:absolute;
  max-width:100vw;
  max-height:100vh;
  object-fit:contain;
  opacity:0;
  transition:opacity 1.4s ease;
}
.slide.show{opacity:1}

/* ================= HUD ================= */
.hud{
  position:fixed;left:12px;right:12px;bottom:12px;
  display:flex;justify-content:space-between;align-items:center;gap:12px;
  color:#fff;
  font:14px/1.2 system-ui,-apple-system,"PingFang TC","Microsoft JhengHei";
  opacity:.85;z-index:10
}
.btns{display:flex;gap:8px;flex-wrap:wrap}
button,select{
  background:rgba(255,255,255,.14);
  color:#fff;border:1px solid rgba(255,255,255,.18);
  padding:8px 10px;border-radius:10px;cursor:pointer
}
input[type=range]{width:140px}
.group{display:flex;align-items:center;gap:10px;flex-wrap:wrap}

/* ================= Overlay ================= */
.overlay{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;z-index:9999;
  opacity:0;transform:scale(1.03);
  transition:opacity .9s ease,transform 1.2s ease
}
.overlay.show{opacity:1;transform:scale(1)}

.card{
  padding:34px 38px;border-radius:18px;text-align:center;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(212,175,55,.28);
  box-shadow:
    0 0 70px rgba(212,175,55,.12),
    inset 0 0 40px rgba(255,255,255,.04)
}

/* ================= Brand (漸層金｜展示版) ================= */
.brand{
  font-family:"Playfair Display","Cormorant Garamond","Libre Baskerville","Times New Roman",serif;
  font-size:46px;letter-spacing:.16em;
  margin:0 0 10px;
  background:linear-gradient(135deg,#fff6df,#e6c36a,#f6e7b7);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  -webkit-text-fill-color:transparent;
  will-change:transform;
  isolation:isolate
}

.date{
  font-family:"Libre Baskerville","Times New Roman",serif;
  font-size:16px;letter-spacing:.18em;
  color:#e8dfc8;margin:0 0 14px
}
.hint{
  font-size:14px;letter-spacing:.08em;
  color:#eae6d8;opacity:.9
}

/* ================= 封面背景風格 ================= */

/* A｜All（主視覺） */
.cover-all{
  background:
    radial-gradient(circle at 50% 40%,
      rgba(255,236,200,.28),
      rgba(40,55,40,.55) 55%,
      rgba(8,10,8,.95)),
    linear-gradient(180deg,#1a2218,#0b0d0a)
}

/* B｜China（紅金） */
.cover-china{
  background:
    radial-gradient(circle at 50% 40%,
      rgba(180,50,40,.35),
      rgba(70,20,20,.65) 55%,
      rgba(15,8,8,.95)),
    linear-gradient(180deg,#2a1515,#0d0606)
}

/* C｜90’s（原 New → 移過來：清新日系） */
.cover-vintage{
  background:
    radial-gradient(circle at 50% 40%,
      rgba(210,230,220,.34),
      rgba(70,90,80,.45) 55%,
      rgba(12,16,14,.95)),
    linear-gradient(180deg,#1f2a25,#0c0f0d)
}

/* D｜New（時尚黑灰金） */
.cover-modern{
  background:
    radial-gradient(circle at 50% 40%,
      rgba(190,190,190,.18),
      rgba(60,60,60,.55) 55%,
      rgba(10,10,10,.95)),
    linear-gradient(180deg,#1a1a1a,#050505)
}

/* E｜Veil（白紗｜亮背景） */
.cover-veil{
  background:
    radial-gradient(circle at 50% 40%,
      rgba(255,255,255,.45),
      rgba(210,200,180,.35) 55%,
      rgba(20,18,15,.95)),
    linear-gradient(180deg,#f2efe8,#15120e)
}

/* ================= Veil 字色加深 ================= */
.cover-veil .brand{
  background:linear-gradient(135deg,#e6d8b8,#c9a24a,#a8873a);
  -webkit-background-clip:text;
  background-clip:text;
  -webkit-text-fill-color:transparent;
}
</style>
</head>

<body>

<div class="wrap">
  <img id="imgA" class="slide show">
  <img id="imgB" class="slide">
</div>

<div class="hud">
  <div class="btns">
    <button id="prev">上一張 ←</button>
    <button id="toggle">暫停</button>
    <button id="next">下一張 →</button>
    <button id="musicToggle">音樂：開</button>
  </div>
  <div class="group">
    <label>套組
      <select id="setSelector">
        <option value="A">All</option>
        <option value="B">China</option>
        <option value="C">90’s</option>
        <option value="D">New</option>
        <option value="E">Veil</option>
      </select>
    </label>
    <span id="counter">- / -</span>
    <label>速度 <input id="speed" type="range" min="2" max="15" value="3"></label>
    <span id="sec">3s</span>
    <label>音量 <input id="volume" type="range" min="0" max="100" value="35"></label>
    <span id="volLabel">35%</span>
    <button id="fs">全螢幕</button>
  </div>
</div>

<div id="overlay" class="overlay cover-all">
  <div class="card">
    <div class="brand" id="coverTitle">LèSën Wedding♥</div>
    <div class="date" id="coverDate">January 10, 2026</div>
    <div class="hint">點一下播放</div>
  </div>
</div>

<audio id="bgm" preload="auto" loop playsinline></audio>

<script>
function track(e,p={}){if(typeof gtag==="function")gtag("event",e,p)}

const imgA=document.getElementById("imgA");
const imgB=document.getElementById("imgB");
let front=imgA,back=imgB;

const counter=document.getElementById("counter");
const speed=document.getElementById("speed");
const sec=document.getElementById("sec");
const overlay=document.getElementById("overlay");
const bgm=document.getElementById("bgm");
const musicToggle=document.getElementById("musicToggle");
const volume=document.getElementById("volume");
const volLabel=document.getElementById("volLabel");
const setSelector=document.getElementById("setSelector");

let photos=[],i=0,timer=null,playing=false,musicOn=true;
let currentSet=(new URLSearchParams(location.search).get("set")||"A").toUpperCase();
setSelector.value=currentSet;

function normalize(list){
  return list.map(s=>s.includes("/")?(s.startsWith("./")?s:"./"+s):"./photos/"+s)
}

function render(){
  const src=photos[i];
  back.onload=()=>{
    back.classList.add("show");
    front.classList.remove("show");
    [front,back]=[back,front];
    counter.textContent=`${i+1} / ${photos.length}`;
  };
  back.src=src;
}

function next(auto=false){
  i=(i+1)%photos.length;
  render();
  if(auto&&i===0){stop();showCover()}
}
function prev(){i=(i-1+photos.length)%photos.length;render()}
function start(){stop();playing=true;timer=setInterval(()=>next(true),Number(speed.value)*1000)}
function stop(){if(timer)clearInterval(timer);timer=null;playing=false}

function setVolume(){bgm.volume=volume.value/100;volLabel.textContent=volume.value+"%"}
async function playMusic(){try{await bgm.play();musicOn=true}catch{}}
function stopMusic(){bgm.pause();musicOn=false}

function showCover(){
  overlay.style.display="flex";
  requestAnimationFrame(()=>overlay.classList.add("show"))
}
function hideCover(){
  overlay.classList.remove("show");
  setTimeout(()=>overlay.style.display="none",700)
}

async function loadSet(set){
  stop();stopMusic();
  overlay.classList.remove("show");overlay.style.display="flex";
  const cfg=await fetch(`./config/${set}.json`).then(r=>r.json());
  overlay.className=`overlay cover-${cfg.coverStyle}`;
  document.getElementById("coverTitle").textContent=cfg.coverTitle;
  document.getElementById("coverDate").textContent=cfg.coverDate;
  bgm.src=cfg.music;
  speed.value=cfg.speedSec;sec.textContent=speed.value+"s";
  photos=normalize(await fetch("./"+cfg.photosJson).then(r=>r.json()));
  i=0;render();setVolume();
  showCover();track("view_set",{set_id:set})
}

overlay.onclick=async ()=>{
  hideCover();
  track("start_playback",{set_id:currentSet});
  await playMusic();start()
};

document.getElementById("next").onclick=()=>next(false);
document.getElementById("prev").onclick=()=>prev();
document.getElementById("toggle").onclick=()=>playing?stop():start();
musicToggle.onclick=()=>musicOn?stopMusic():playMusic();
volume.oninput=()=>{setVolume();if(!musicOn)playMusic()};
speed.oninput=()=>{sec.textContent=speed.value+"s";if(playing)start()};
setSelector.onchange=async ()=>{
  currentSet=setSelector.value;
  history.replaceState(null,"",`?set=${currentSet}`);
  await loadSet(currentSet)
};
document.getElementById("fs").onclick=async ()=>{
  try{
    if(!document.fullscreenElement)await document.documentElement.requestFullscreen();
    else await document.exitFullscreen()
  }catch(e){}
};

loadSet(currentSet);
</script>

</body>
</html>
